# 変更履歴

このファイルはS WORKSプロジェクトの重要な変更、アーキテクチャの修正、機能追加を記録します。

## [2025-11-18] - テンプレート編集ページの5件制限対応

### 変更内容
テンプレート編集ページで「スキル・経験」「服装・身だしなみ」「持ち物・その他」フィールドに5件制限を追加

### 変更理由
- テンプレート作成ページには既に5件制限が実装済みだったが、編集ページには未実装だった
- 作成と編集で仕様を統一し、データの一貫性を保つため
- ユーザーに対して明確な制限を示し、無制限に項目が追加されることを防ぐ

### 修正されたファイル

#### テンプレート編集ページ
- `/app/admin/jobs/templates/[id]/edit/page.tsx`
  - `addToArray`関数に5件制限のロジックを追加
  - スキル・経験フィールド:
    - ラベルに「（5つまで入力可能）」を追加
    - 入力フィールドとボタンに`disabled={formData.skills.length >= 5}`を追加
  - 服装・身だしなみフィールド:
    - ラベルに「（5つまで入力可能）」を追加
    - 入力フィールドとボタンに`disabled={formData.dresscode.length >= 5}`を追加
  - 持ち物・その他フィールド:
    - ラベルに「（5つまで入力可能）」を追加
    - 入力フィールドとボタンに`disabled={formData.belongings.length >= 5}`を追加

### 後方互換性
- 既存のダミーデータ（全10テンプレート）は全て5件または6件のデータを持っているが、表示には影響なし
- 編集時は5件制限が適用され、6件目以降は追加不可

### 確認事項
- 全10テンプレートのダミーデータに画像パス（`images`フィールド）が既に設定済みであることを確認

---

## [2025-11-18] - テンプレートアーキテクチャの修正

### 変更内容
**重要なアーキテクチャ変更**: テンプレートシステムを事業所ベースから企業全体ベースに変更

### 変更理由
- 初期設計では、テンプレートが各事業所に紐づいていた（`facilityId`フィールドを持っていた）
- 正しい仕様: テンプレートは企業全体で共有され、特定の事業所には紐づかない
- 案件作成時に、事業所とテンプレートを個別に選択する

### 修正されたファイル

#### データ構造
- `/data/jobTemplates.ts`
  - `JobTemplate`インターフェースから`facilityId`、`address`、`access`フィールドを削除
  - 全7テンプレートから事業所固有のデータを削除

#### UI コンポーネント
- `/app/admin/jobs/templates/page.tsx`
  - 事業所フィルター機能を削除
  - 全テンプレートを表示（フィルタリングなし）

- `/app/admin/jobs/templates/new/page.tsx`
  - 事業所選択ドロップダウンを削除
  - 住所・アクセス入力フィールドを削除

- `/app/admin/jobs/templates/[id]/edit/page.tsx`
  - 事業所選択ドロップダウンを削除
  - 住所・アクセス入力フィールドを削除

- `/app/admin/jobs/new/page.tsx`
  - テンプレート選択を事業所選択から独立
  - 全テンプレートを表示（`availableTemplates = jobTemplates`）

#### ドキュメント
- `/docs/requirements.md`
  - テンプレート機能セクションを追加
  - `JobTemplates`テーブル定義を追加
  - `Jobs`テーブルに`template_id`フィールドを追加

- `/docs/PHASE1_PLAN.md`
  - `JobTemplate`インターフェース定義を追加
  - `Job`インターフェースに`templateId`フィールドを追加
  - ダミーデータ作成ステップにテンプレートデータを追加

#### クリーンアップ
- `/requirements.md` (ルート) - 削除（重複ファイル、`/docs/requirements.md`と同一内容）

### データベースへの影響（将来）
Phase 2以降でデータベースを実装する際:
- `job_templates`テーブルを作成（`facility_id`カラムなし）
- `jobs`テーブルに`template_id`カラムを追加（NULL許容、外部キー制約）

### 後方互換性
- 既存のダミーデータは互換性があるよう更新済み
- UIは新しいアーキテクチャで正常に動作

---

## 今後の変更履歴

各重要な変更・機能追加・バグ修正は以下の形式で記録してください:

```markdown
## [YYYY-MM-DD] - 変更タイトル

### 変更内容
- 何が変更されたか

### 変更理由
- なぜ変更が必要だったか

### 修正されたファイル
- 変更されたファイルのリスト

### データベースへの影響
- DBスキーマの変更があれば記載

### 後方互換性
- 互換性に関する注意事項
```
