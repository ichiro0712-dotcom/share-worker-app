# ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ç°¡ç´ åŒ–ä»•æ§˜æ›¸

## æ¦‚è¦

ãƒ¯ãƒ¼ã‚«ãƒ¼æ–°è¦ç™»éŒ²æ™‚ã®å¿…é ˆå…¥åŠ›é …ç›®ã‚’æœ€å°é™ã«æŠ‘ãˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²éšœå£ã‚’ä¸‹ã’ã‚‹ã€‚
è©³ç´°ãªãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã¯ç™»éŒ²å¾Œã«ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰å…¥åŠ›ã™ã‚‹è¨­è¨ˆã€‚

## å®Ÿè£…æ—¥

2026-02-06ï¼ˆPR #303ï¼‰

---

## ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ä»•æ§˜

### å¿…é ˆå…¥åŠ›é …ç›®ï¼ˆ4é …ç›®ã®ã¿ï¼‰

| é …ç›® | èª¬æ˜ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
|------|------|----------------|
| ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | ãƒ­ã‚°ã‚¤ãƒ³IDå…¼é€£çµ¡å…ˆ | ãƒ¡ãƒ¼ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯ã€ç¢ºèªå…¥åŠ›ã¨ã®ä¸€è‡´ |
| ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆç¢ºèªï¼‰ | å…¥åŠ›ãƒŸã‚¹é˜²æ­¢ | ä¸Šè¨˜ã¨ä¸€è‡´ |
| é›»è©±ç•ªå· | æœ¬äººç¢ºèªãƒ»ç·Šæ€¥é€£çµ¡ç”¨ | 10æ¡ã¾ãŸã¯11æ¡ã®æ•°å­— |
| ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | èªè¨¼ç”¨ | 8æ–‡å­—ä»¥ä¸Š |
| ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªï¼‰ | å…¥åŠ›ãƒŸã‚¹é˜²æ­¢ | ä¸Šè¨˜ã¨ä¸€è‡´ |
| åˆ©ç”¨è¦ç´„åŒæ„ | æ³•çš„è¦ä»¶ | ãƒã‚§ãƒƒã‚¯å¿…é ˆ |

### å‰Šé™¤ã—ãŸå…¥åŠ›é …ç›®

ä»¥ä¸‹ã®é …ç›®ã¯ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å‰Šé™¤ã€‚ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ç”»é¢ã§å…¥åŠ›å¯èƒ½ã€‚

- æ°åï¼ˆå§“ãƒ»åï¼‰
- ãƒ•ãƒªã‚¬ãƒŠï¼ˆã‚»ã‚¤ãƒ»ãƒ¡ã‚¤ï¼‰
- ç”Ÿå¹´æœˆæ—¥
- æ€§åˆ¥
- å›½ç±
- ä½æ‰€ï¼ˆéƒµä¾¿ç•ªå·ãƒ»éƒ½é“åºœçœŒãƒ»å¸‚åŒºç”ºæ‘ãƒ»ç•ªåœ°ãƒ»å»ºç‰©åï¼‰
- ä¿æœ‰è³‡æ ¼
- è³‡æ ¼è¨¼æ˜æ›¸ï¼ˆç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰
- çµŒé¨“åˆ†é‡
- çµŒé¨“å¹´æ•°
- è·æ­´

---

## DBè¨­è¨ˆ

### User ãƒ†ãƒ¼ãƒ–ãƒ«å¤‰æ›´ç‚¹

```prisma
model User {
  // å¤‰æ›´å‰
  name String

  // å¤‰æ›´å¾Œ
  name String @default("")
}
```

- `name` ã‚«ãƒ©ãƒ ã«ç©ºæ–‡å­—ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è¿½åŠ 
- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å½±éŸ¿ãªã—ï¼ˆå…¨ã¦ name ãŒå…¥ã£ã¦ã„ã‚‹ï¼‰
- æ–°è¦ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ `name = ""` ã§ä½œæˆã•ã‚Œã‚‹

---

## ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å®Œäº†ãƒã‚§ãƒƒã‚¯

### checkProfileComplete() é–¢æ•°

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/lib/actions/user-profile.ts`

æ±‚äººå¿œå‹Ÿå‰ã«å‘¼ã³å‡ºã•ã‚Œã€ä»¥ä¸‹ã®é …ç›®ãŒå…¥åŠ›æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹:

| é …ç›® | DBã‚«ãƒ©ãƒ  | å¿…é ˆç†ç”± |
|------|----------|----------|
| æ°å | `name` | å¥‘ç´„æ›¸ãƒ»æ›¸é¡ä½œæˆã«å¿…è¦ |
| ãƒ•ãƒªã‚¬ãƒŠï¼ˆã‚»ã‚¤ï¼‰ | `last_name_kana` | æ­£ç¢ºãªèª­ã¿æ–¹ã®æŠŠæ¡ |
| ãƒ•ãƒªã‚¬ãƒŠï¼ˆãƒ¡ã‚¤ï¼‰ | `first_name_kana` | åŒä¸Š |
| æ€§åˆ¥ | `gender` | ã‚·ãƒ•ãƒˆé…ç½®ã®å‚è€ƒ |
| ç”Ÿå¹´æœˆæ—¥ | `birth_date` | å¹´é½¢ç¢ºèªãƒ»åŠ´åƒæ¡ä»¶ |
| å›½ç± | `nationality` | å°±åŠ´è³‡æ ¼ç¢ºèª |
| éƒ½é“åºœçœŒ | `prefecture` | å‹¤å‹™å¯èƒ½ã‚¨ãƒªã‚¢ã®æŠŠæ¡ |
| å¸‚åŒºç”ºæ‘ | `city` | åŒä¸Š |
| ä½æ‰€ | `address_line` | æ›¸é¡é€ä»˜å…ˆ |
| è³‡æ ¼ | `qualifications` | æ¥­å‹™é©æ€§ç¢ºèª |
| çµŒé¨“åˆ†é‡ | `experience_fields` | çµŒé¨“ã«åŸºã¥ãé…ç½® |

### ãƒã‚§ãƒƒã‚¯ã®å®Ÿè£…

```typescript
// ç©ºæ–‡å­—ã‚‚æœªå…¥åŠ›ã¨ã—ã¦æ‰±ã†
const value = user[field.key as keyof typeof user];
if (!value || (typeof value === 'string' && value.trim() === '')) {
    missingFields.push(field.label);
}
```

---

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼

```
1. æ–°è¦ç™»éŒ²ãƒšãƒ¼ã‚¸ (/register/worker)
   â””â”€ ãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»é›»è©±ç•ªå·ã®ã¿å…¥åŠ›
   â””â”€ åˆ©ç”¨è¦ç´„ã«åŒæ„
   â””â”€ ç™»éŒ²ãƒœã‚¿ãƒ³

2. ãƒ¡ãƒ¼ãƒ«èªè¨¼å¾…ã¡ (/auth/verify-pending)
   â””â”€ ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡æ¸ˆã¿ç”»é¢

3. ãƒ¡ãƒ¼ãƒ«èªè¨¼å®Œäº†
   â””â”€ ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½ã«

4. ãƒã‚¤ãƒšãƒ¼ã‚¸ (/mypage)
   â””â”€ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ã¸èª˜å°

5. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† (/mypage/profile/edit)
   â””â”€ è©³ç´°æƒ…å ±ã‚’å…¥åŠ›
   â””â”€ è³‡æ ¼è¨¼æ˜æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

6. æ±‚äººå¿œå‹Ÿæ™‚
   â””â”€ checkProfileComplete() ã§ãƒã‚§ãƒƒã‚¯
   â””â”€ æœªå…¥åŠ›é …ç›®ãŒã‚ã‚Œã°å¿œå‹Ÿä¸å¯
   â””â”€ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ç”»é¢ã¸èª˜å°
```

---

## UI/UXè¨­è¨ˆ

### ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ 

- æœ€å¤§å¹…: `max-w-xl`ï¼ˆå¾“æ¥ã¯ `max-w-4xl`ï¼‰
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†ã‘ãªã—ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªç¸¦ä¸¦ã³ï¼‰
- æ¡ˆå†…æ–‡è¡¨ç¤º:
  > ğŸ“ æ°åãƒ»ä½æ‰€ãƒ»è³‡æ ¼ãªã©ã®è©³ç´°æƒ…å ±ã¯ã€ç™»éŒ²å¾Œã«ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰å…¥åŠ›ã§ãã¾ã™ã€‚æ±‚äººã«å¿œå‹Ÿã™ã‚‹éš›ã«å¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

### ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

- æœªå…¥åŠ›é …ç›®: èµ¤æ  + ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ãƒ¡ãƒ¼ãƒ«ä¸ä¸€è‡´: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è­¦å‘Šè¡¨ç¤º
- ãƒ¡ãƒ¼ãƒ«ä¸€è‡´: ç·‘è‰²ã§ã€Œâœ“ ä¸€è‡´ã—ã¦ã„ã¾ã™ã€è¡¨ç¤º

---

## ç®¡ç†ç”»é¢å¯¾å¿œ

### åå‰ãŒç©ºã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤º

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¡¨ç¤ºã‚’å®Ÿè£…:

| ãƒ•ã‚¡ã‚¤ãƒ« | å¯¾å¿œ |
|----------|------|
| `app/admin/workers/page.tsx` | `worker.name \|\| 'åå‰æœªè¨­å®š'` |
| `app/admin/workers/[id]/page.tsx` | åŒä¸Š |
| `app/system-admin/workers/page.tsx` | åŒä¸Š |
| `app/system-admin/workers/[id]/page.tsx` | åŒä¸Š |

### ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºï¼ˆã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ï¼‰

åå‰ãŒç©ºã®å ´åˆã¯ `?` ã‚’è¡¨ç¤º:
```tsx
{(worker.name || '?').charAt(0)}
```

---

## APIå¤‰æ›´

### POST /api/auth/register

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ï¼ˆå¿…é ˆï¼‰:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "phoneNumber": "09012345678"
}
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆLPè¿½è·¡ç”¨ï¼‰:**
```json
{
  "registrationLpId": "lp_123",
  "registrationCampaignCode": "NRS-001",
  "registrationGenrePrefix": "NRS"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "message": "ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ",
  "user": {
    "id": 123,
    "email": "user@example.com"
  }
}
```

---

## é€šçŸ¥ãƒ¡ãƒ¼ãƒ«å¯¾å¿œ

### ãƒ¡ãƒ¼ãƒ«èªè¨¼ãƒ¡ãƒ¼ãƒ«

```typescript
sendVerificationEmail(
  user.id,
  user.email,
  user.name || 'TASTASãƒ¦ãƒ¼ã‚¶ãƒ¼'  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
);
```

### ç®¡ç†è€…é€šçŸ¥ãƒ¡ãƒ¼ãƒ«

```typescript
sendAdminNewWorkerNotification(
  user.id,
  user.name || 'åå‰æœªè¨­å®š',  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  user.email
);
```

---

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®æ‰‹é †

1. PR #303 ã‚’ develop ã«ãƒãƒ¼ã‚¸
2. ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§å‹•ä½œç¢ºèª
3. develop ã‚’ main ã«ãƒãƒ¼ã‚¸
4. æœ¬ç•ªDBã«ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã‚’é©ç”¨:
   ```bash
   npx prisma db push
   ```

### æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¸ã®å½±éŸ¿

- ãªã—ï¼ˆæ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…¨ã¦ name ãŒå…¥åŠ›æ¸ˆã¿ï¼‰

---

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² |
|----------|------|
| `app/register/worker/page.tsx` | ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ UI |
| `app/api/auth/register/route.ts` | ç™»éŒ²API |
| `src/lib/actions/user-profile.ts` | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å®Œäº†ãƒã‚§ãƒƒã‚¯ |
| `prisma/schema.prisma` | DBã‚¹ã‚­ãƒ¼ãƒå®šç¾© |
| `app/mypage/profile/edit/` | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ç”»é¢ |
