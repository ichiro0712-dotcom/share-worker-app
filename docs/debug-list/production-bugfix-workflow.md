# 本番サイト バグ修正ワークフロー

**作成日**: 2026-01-20
**最終更新**: 2026-01-20
**CSVソース**: `本番サイト_tastas_デバックsheet - シート1 (1).csv`

---

## 対応状況サマリー

| ステータス | 件数 |
|------------|------|
| ✅ 完了 | 7件 |
| 🔧 対応予定 | 1件 |
| 🔍 要調査 | 4件 |
| ⏸️ 除外（ビジネス判断必要） | 4件 |

---

## 全項目一覧

| ID | 種別 | 報告者 | 概要 | ステータス | 対応内容 |
|---|------|--------|------|------------|----------|
| 1 | 提案 | 竹上 | ログイン認証後のフロー | ⏸️ 除外 | ビジネス判断必要（P1除外指示） |
| 2 | 提案 | 竹上 | 求人掲載の期限（開始時間を過ぎても応募可能） | ⏸️ 除外 | 仕様確認必要 |
| 3 | バグ | 竹上 | 求人詳細のマップ（都庁表示） | ✅ 完了 | 住所ベースのフォールバック追加 |
| 4 | バグ | 水野 | ログイン時デバッグエラー表示 | ✅ 完了 | 環境変数で制御 |
| 5 | 提案 | 水野 | 身分証明書の項目位置（任意→必須） | ⏸️ 除外 | ビジネス判断必要 |
| 6 | バグ | 水野 | 距離検索エラー（1km以内でも遠い案件表示） | ✅ 完了 | 型変換（Number()）追加 |
| 7 | バグ | 水野 | 地図エラー | ✅ 完了 | ID3と同じ修正 |
| 8 | 提案 | 竹上 | ワーカー管理画面（キャンセル件数表示） | ⏸️ 除外 | 機能追加（工数中） |
| 9 | 提案 | 竹上 | 施設管理画面（詳細確認・メアド検索） | ⏸️ 除外 | 機能追加（工数大） |
| 10 | 提案 | 竹上 | 法人番号の全角→半角変換 | ✅ 完了 | 全角数字の変換処理追加 |
| 11 | 提案 | 竹上 | 電話番号フォーマット（03番号） | ✅ 完了 | 市外局番パターン別フォーマット |
| 12 | バグ | 竹上 | 最寄り駅フィールド | 🔍 要調査 | フィールドの有無確認 |
| 13 | 提案 | 竹上 | 担当者顔写真の削除 | 🔧 対応予定 | 項目自体を削除 |
| 14 | バグ | 竹上 | 施設担当者写真アップロードエラー | 🔍 要調査 | サーバーエラーの原因調査 |
| 15 | バグ | 水野 | Google Maps APIキー未設定 | 🔍 要調査 | 環境変数設定確認 |
| 16 | バグ | 水野 | 施設住所コピー時のエラー | 🔍 要調査 | 法人住所→施設住所コピー機能 |

---

## 完了した修正の詳細

### ID 3, 7: 地図表示問題
**修正ファイル**: `components/job/JobDetailClient.tsx`
**修正内容**: lat/lngが無効な場合、住所ベースで地図を表示するフォールバックを追加

### ID 4: ログインエラー表示
**修正ファイル**: `components/debug/DebugErrorBanner.tsx`
**修正内容**: `DEBUG_MODE`を`process.env.NODE_ENV === 'development'`に変更

### ID 6: 距離検索エラー
**修正ファイル**: `src/lib/actions/job-worker.ts`
**修正内容**: `distanceKm`, `distanceLat`, `distanceLng`に`Number()`で明示的な型変換を追加

### ID 10: 法人番号の全角→半角変換
**修正ファイル**: `app/admin/facility/page.tsx`
**修正内容**: 全角数字（０-９）を半角に変換する処理を追加

### ID 11: 電話番号フォーマット
**修正ファイル**: `utils/inputValidation.ts`
**修正内容**: 市外局番パターン（03/06: 2桁、携帯: 3桁、その他: 3桁）に応じたフォーマットに改善

### 追加修正: パスワード自動入力問題
**修正ファイル**: `app/login/page.tsx`
**修正内容**: メールアドレスとパスワードフィールドに`autocomplete`属性を追加

---

## 対応予定のタスク

### ID 13: 担当者顔写真の削除

**対応方針**: 項目自体を削除

**影響範囲**:
- [ ] `app/admin/facility/page.tsx` - 施設管理画面
- [ ] `app/system-admin/facilities/new/page.tsx` - 施設登録画面
- [ ] `prisma/schema.prisma` - DBスキーマ（staff_photo フィールド）
- [ ] 関連するAPI・Server Actions

**作業手順**:
1. UIから担当者顔写真の入力フィールドを削除
2. Server Actionsからstaff_photo関連の処理を削除
3. （任意）DBマイグレーションでカラム削除

---

## 要調査項目

### ID 12: 最寄り駅フィールド
- 施設登録画面に最寄り駅フィールドが存在するか確認
- 仕様として削除されたのか、バグで表示されていないのか確認

### ID 14: 施設担当者写真アップロードエラー
- エラーログの確認
- Supabase Storageの設定確認
- ファイルサイズ・形式の制限確認

---

## 修正ファイル一覧

```
components/debug/DebugErrorBanner.tsx    # DEBUG_MODE修正
components/job/JobDetailClient.tsx       # 地図表示フォールバック
src/lib/actions/job-worker.ts            # 距離検索の型変換
app/login/page.tsx                       # autocomplete属性
app/admin/facility/page.tsx              # 法人番号の全角→半角変換
utils/inputValidation.ts                 # 電話番号フォーマット改善
```

---

**最終更新**: 2026-01-20
