# システム管理者機能 - 要件メモ

> **作成日**: 2025-12-04
> **ステータス**: 計画中（ワーカー・施設画面完成後に着手）
> **優先度**: 高（必須）

---

## 1. 概要

S WORKSプラットフォーム全体を管理するシステム管理者向け機能。
ワーカー画面・施設管理画面が完成した後に開発を開始する。

---

## 2. 必須機能

### 2.1 ユーザー管理

**ワーカー管理**
- ワーカー一覧・検索・詳細閲覧
- アカウント状態管理（有効/停止/凍結）
- 低評価・高キャンセル率ユーザーへのペナルティ設定
- ペナルティ条件のカスタマイズ

**施設管理**
- 施設一覧・検索・詳細閲覧
- 施設審査機能（新規施設の承認/却下）
- 施設管理者アカウント管理
- 問題施設の対応

### 2.2 施設データ管理

**マップピン位置調整**
- 施設の地図マーカー位置の微調整機能
- 方向ボタンによる緯度経度の調整（小/中/大の3段階）
- 調整後のプレビュー確認
- 地図画像の自動再生成
- ※ 施設管理者は運営サポートに依頼して調整（自分では変更不可）
- ※ コンポーネント実装済み: `components/admin/MapPinAdjustModal.tsx`

### 2.3 コンテンツ管理

**求人管理**
- 求人監視・不適切求人の検出
- 求人の強制停止・削除
- 求人ガイドライン設定

**レビュー管理**
- 不適切レビューの検出・削除
- レビューガイドライン設定

### 2.4 通知・メッセージ管理

**プッシュ通知設定**
- 通知テンプレート管理
- 自動通知タイミング設定
  - マッチング成立時
  - 勤務前日リマインド
  - 勤務当日リマインド
  - 勤務終了後
  - レビュー催促
- 一斉通知機能（お知らせ配信）

**自動メッセージ設定**
- システムメッセージテンプレート
- 送信タイミング設定

### 2.5 システム設定

**キャンセルポリシー設定**
- キャンセル率に反映される条件
  - マッチング後何時間以降でカウントするか
- 直前キャンセル率の条件
  - 勤務開始何時間以内でカウントするか
- ペナルティ閾値の設定

**評価・ペナルティ設定**
- 低評価の定義（何点以下か）
- ペナルティ発動条件
  - 連続低評価回数
  - キャンセル率閾値
- ペナルティ内容
  - 警告通知
  - 機能制限
  - アカウント一時停止
  - アカウント凍結

---

## 3. 将来機能

### 3.1 売上・手数料管理
- 取引履歴
- 手数料計算
- 請求書発行

### 3.2 分析・レポート
- ユーザー統計
- 求人統計
- マッチング成功率
- 地域別分析

### 3.3 外部システム連携
- 別チーム開発の出勤管理システムとの連携
- 給与計算システムとの連携
- 給与明細機能

---

## 4. 特別要件：バイブコーディング対応機能

### 4.1 概要
システム管理者自身が、AIアシスタント（バイブコーディング）を使って
安全にシステムの軽微な変更・機能追加ができる仕組み。

### 4.2 想定ユースケース
- プッシュ通知の文面変更
- ボタンのラベル変更
- 簡単なUI調整
- 新しい通知タイプの追加

### 4.3 安全要件
- **変更可能範囲の制限**: 危険な変更（DB操作、認証ロジック、決済関連）は不可
- **プレビュー機能**: 変更前に影響範囲を確認
- **ロールバック**: 問題があった場合の即座の巻き戻し
- **変更履歴**: 誰がいつ何を変更したかの記録
- **承認フロー**: 重要な変更は別の管理者の承認が必要

### 4.4 技術的アプローチ（検討中）
- コンテンツ管理システム（CMS）的なアプローチ
- 設定ファイルベースの変更
- サンドボックス環境でのテスト
- Feature Flag による段階的リリース

---

## 5. 画面一覧（予定）

| パス | 画面名 | 説明 |
|------|--------|------|
| `/system-admin` | ダッシュボード | 全体統計・アラート |
| `/system-admin/users` | ワーカー管理 | 一覧・検索・詳細 |
| `/system-admin/facilities` | 施設管理 | 一覧・審査・詳細 |
| `/system-admin/facilities/[id]/map` | マップピン調整 | 施設の地図マーカー位置調整 |
| `/system-admin/jobs` | 求人管理 | 監視・対応 |
| `/system-admin/reviews` | レビュー管理 | 監視・対応 |
| `/system-admin/notifications` | 通知設定 | テンプレート・タイミング |
| `/system-admin/settings` | システム設定 | ポリシー・閾値 |
| `/system-admin/reports` | レポート | 統計・分析 |

---

## 6. 認証・権限

- システム管理者専用の認証（施設管理者とは別）
- 権限レベル
  - **Super Admin**: 全機能アクセス可
  - **Admin**: 閲覧・基本操作のみ
  - **Viewer**: 閲覧のみ

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-12-04 | 初版作成。要件メモとして整理 |
| 2025-12-05 | マップピン位置調整機能を追加（施設管理者は運営に依頼） |
