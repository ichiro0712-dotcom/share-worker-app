# +TASTAS - 要件定義書（実装ベース）

> **最終更新**: 2025-12-04
> **ステータス**: 実稼働システムからの逆引き定義

---

## 1. サービス概要

### 1.1 サービス名
**+TASTAS（エスワークス）**

### 1.2 サービス説明
看護師・介護士のための求人マッチングWebサービス。
単発・短期の仕事を中心に、働きたい日時で柔軟に仕事を探せるプラットフォーム。

### 1.3 ターゲットユーザー

#### ワーカー（求職者）
- 看護師（正看護師、准看護師）
- 介護士（介護福祉士、ヘルパー等）
- ブランクがある方
- 副業・Wワークを希望する方
- 単発・短期で働きたい方

#### 施設（求人掲載側）
- 介護施設（特養、老健、グループホームなど）
- 医療施設
- 訪問介護事業所
- デイサービス

---

## 2. 実装済み機能

### 2.1 ワーカー向け機能

#### 2.1.1 認証
| 機能 | 実装状況 | 説明 |
|------|----------|------|
| メールログイン | ✅ 完了 | メール/パスワードでログイン |
| セッション管理 | ✅ 完了 | NextAuth.jsによるJWT管理 |
| ログアウト | ✅ 完了 | セッション破棄 |
| 会員登録 | ⚠️ 一部 | フォームUI準備済み、フロー未完成 |
| SNS連携 | ❌ 未実装 | Google/LINE連携（UI準備のみ） |

#### 2.1.2 求人検索・閲覧

**求人一覧（トップページ）**
- キーワード検索（求人タイトル・施設名）
- 都道府県フィルター
- 市区町村フィルター
- 時給フィルター（最小時給指定）
- サービスタイプ別フィルター
- 移動手段フィルター（車、バイク、自転車、公共交通）
- こだわり条件フィルター
- 並べ替え（時給順、締切順、新着順）
- URLクエリパラメータによるフィルター保持

**求人詳細**
- 施設画像カルーセル表示
- 基本情報（勤務時間、報酬、締切）
- 業務内容詳細
- 必要資格・経験
- 服装・持ち物
- 移動手段・駐車場情報
- 応募状況表示（募集人数/応募人数）
- 施設評価・レビュー表示
- 責任者情報・メッセージ
- 同施設の他日程求人表示
- タブナビゲーション

#### 2.1.3 応募機能

**応募フロー**
1. 求人詳細ページで「申し込む」
2. 応募確認画面（プロフィール・資格確認）
3. 応募完了画面
4. **即時マッチング**（通常求人の場合、応募完了時点でマッチング成立）

**マッチング方式**
- **通常求人**: 応募完了 → 即座にマッチング成立（`SCHEDULED`）
- **審査あり求人**: 応募完了 → 応募中（`APPLIED`） → 施設がマッチング決定 → マッチング成立（`SCHEDULED`）

**募集人数制限**
- 募集人数の上限に達すると、その日の枠は応募不可になる（ただし、審査あり求人は上限を超えて応募可能）
- 複数日の求人は、日ごとに枠が終了していく
- 全ての日の枠が埋まると、親求人も「募集終了」表示に切り替わる
- 募集終了日時が来ると、求人は非表示になる

**応募管理（仕事管理）**
- 応募履歴一覧
- タブ構成: 審査中 / 仕事の予定 / 勤務中 / 完了 / キャンセル
- ステータス確認
  - APPLIED（審査中）※審査あり求人のみ
  - SCHEDULED（マッチング済・勤務予定）
  - WORKING（勤務中）
  - COMPLETED_PENDING（完了・評価待ち）
  - COMPLETED_RATED（評価完了）
  - CANCELLED（キャンセル）
- **審査中の応募キャンセル**
  - ワーカーは審査中（APPLIED）の応募をキャンセル可能
  - キャンセル確認モーダルで「キャンセルしてもキャンセル率に影響なし」を明記
  - 審査中キャンセルはキャンセル率にカウントされない
- キャンセル通知機能
  - 施設からキャンセルされた場合、仕事管理画面上部に通知バナー表示
  - キャンセルされた仕事の詳細を開くと通知が既読になる
  - 未読時はフッターナビの仕事管理アイコンにバッジ表示

#### 2.1.4 メッセージ機能
- 施設とのメッセージやり取り
- 会話一覧表示
- 未読バッジ表示
- 既読管理
- **開始条件**: いつでも可能（応募前でも可）
- **ファイル添付**: 可能
- **自動メッセージ**: マッチング成立時、勤務前日、勤務当日、勤務終了後、レビュー催促など（システム管理者画面で設定予定）

#### 2.1.5 レビュー機能

**施設への評価**
- 5段階総合評価
- 詳細評価項目
  - 勤怠・時間
  - スキル
  - 遂行力
  - コミュニケーション力
  - 姿勢
- 良かった点・改善点コメント

**受け取ったレビュー**
- 施設からの評価確認
- **公開範囲**: 本人および他の施設から閲覧可能

#### 2.1.6 ブックマーク・お気に入り
- 求人を「お気に入り」登録
- 求人を「あとで見る」保存
- お気に入り施設管理
- ミュート機能（特定施設の求人を非表示）

#### 2.1.7 プロフィール管理

**基本情報**
- 氏名（カナ含む）
- 性別・国籍
- 生年月日
- 電話番号
- プロフィール画像

**住所情報**
- 郵便番号
- 都道府県・市区町村
- 番地・建物名

**緊急連絡先**
- 氏名・続柄
- 電話番号・住所

**資格・経験**
- 保有資格（看護師、介護福祉士など）
- 経験分野と年数
- 職歴

**希望勤務条件**
- 現在の働き方・希望の働き方
- 転職意欲
- 希望勤務日数/週
- 希望勤務期間
- 希望曜日・時間帯

**その他**
- 自己PR
- 銀行口座情報
- 年金番号

#### 2.1.8 通知機能
- 通知一覧表示
- 通知タイプ
  - 応募承認通知
  - 応募却下通知
  - 新着メッセージ通知
  - レビュー依頼通知
  - システム通知
- 既読管理
- 未読カウント

---

### 2.2 施設管理者向け機能

#### 2.2.1 認証
| 機能 | 実装状況 | 説明 |
|------|----------|------|
| メールログイン | ✅ 完了 | 施設管理者専用ログイン |
| セッション管理 | ✅ 完了 | localStorage/8時間有効 |
| ログアウト | ✅ 完了 | セッション破棄 |

#### 2.2.2 求人管理

**求人作成**
- テンプレートからの作成
- 詳細入力フォーム
  - 基本情報（タイトル、勤務時間）
  - 報酬（時給、日給、交通費）
  - 複数勤務日設定
  - 募集人数（日別設定可）
  - 締切日設定
  - 業務内容（複数選択）
  - 必要資格・経験
  - 服装・持ち物
  - 移動手段設定
  - こだわり条件設定
  - 募集条件（週N回以上など）
  - 責任者情報
  - 画像アップロード

**求人オプション**
- ☑️ 審査してからマッチング: 有効にすると、応募後に施設が手動でマッチング決定する

**求人ステータス管理**
- DRAFT（下書き）
- PUBLISHED（公開中）
- STOPPED（停止中）
- WORKING（勤務中）
- COMPLETED（完了）
- CANCELLED（キャンセル）

**テンプレート機能**
- テンプレート作成・編集・削除
- 施設全体で共有
- 求人作成時にテンプレート適用

#### 2.2.4 応募者管理

**2つのビュー**
- **求人からビュー**: 求人ごとの応募者一覧（従来の画面）
- **ワーカーからビュー**: ワーカーごとの応募履歴一覧（新規）
  - ワーカーカード形式（顔写真、氏名、年齢、性別、資格、経験）
  - お気に入り・ブロックボタン
  - カードクリックでワーカー詳細へ遷移

**審査あり求人の応募者操作**
- [マッチング決定] ボタン: 応募者をマッチング成立（`SCHEDULED`）に
- [不採用] ボタン: 応募を却下

**通常求人の応募者操作**
- 応募完了時点で即マッチングのため、承認操作は不要
- キャンセル操作のみ（勤務開始時刻前まで）

**キャンセルルール**
- 施設は勤務開始時刻**前**までキャンセル可能
- 勤務開始時刻**以降**はキャンセル不可
- 施設からのキャンセルはペナルティなし（キャンセル率に反映しない）

**共通機能**
- ワーカープロフィール確認
- 直前キャンセル率表示
- 応募者の評価・レビュー確認

#### 2.2.5 ワーカー管理
- 勤務したワーカー一覧
- 職種別・ステータス別フィルタリング
- ワーカー詳細情報確認
- ワーカーを「お気に入り」登録
- ワーカー検索

#### 2.2.6 レビュー機能

**ワーカーへの評価**
- 5段階総合評価
- 詳細評価項目（ワーカーと同じ）
- 良かった点・改善点コメント
- レビューテンプレート機能

**受け取ったレビュー**
- ワーカーからの施設評価確認
- レビュー統計表示

#### 2.2.7 メッセージ機能
- ワーカーとのメッセージ管理
- 応募者別メッセージスレッド
- 自動送信メッセージ設定（初回メッセージ）

#### 2.2.8 施設情報管理
- 基本情報編集（法人名、施設名、種別）
- 住所・連絡先
- 説明文・画像
- 初回メッセージ設定

---

## 3. 未実装機能

### 3.1 認証関連
| 機能 | 優先度 | 説明 |
|------|--------|------|
| 会員登録フロー完成 | 高 | 新規ユーザー獲得に必須 |
| SNS連携（Google/LINE） | 中 | UI準備済み、実装のみ |
| パスワードリセット | 中 | メール送信機能必要 |

### 3.2 プラットフォーム管理（システム管理者機能）
| 機能 | 優先度 | 説明 |
|------|--------|------|
| システム管理者機能 | **高（必須）** | ワーカー・施設画面完成後に着手。詳細は `docs/system-admin-features.md` 参照 |
| プッシュ通知 | **高** | システム管理者画面で設定可能に |
| ユーザー管理画面 | 高 | ワーカー・施設の管理 |
| 施設審査機能 | 高 | 新規施設の審査 |
| 求人監視機能 | 中 | 不適切求人の管理 |
| レビュー管理 | 中 | 不適切レビューの削除 |
| 売上・手数料管理 | 低 | ビジネス機能 |

### 3.3 高度な機能
| 機能 | 優先度 | 説明 |
|------|--------|------|
| 給与明細 | 中 | 別チームの出勤管理システムとマージ予定 |
| 限定求人 | 中 | 特定ユーザーへの限定公開 |
| 指名機能 | 中 | リピート依頼機能 |
| 位置情報での求人検索 | 低 | 将来実装 |
| レコメンド機能 | 低 | AIマッチング |
| 収入管理 | 低 | ワーカー向け収入統計 |

### 3.4 外部連携
| 機能 | 優先度 | 説明 |
|------|--------|------|
| メール送信 | 高 | 確認メール、通知メール |
| Google Maps | 中 | 地図表示・ルート案内 |
| 決済機能 | 低 | 手数料徴収 |

---

## 4. 画面一覧

### 4.1 ワーカー向け画面

| パス | 画面名 | 実装状況 |
|------|--------|----------|
| `/` | 求人一覧（トップページ） | ✅ |
| `/jobs/[id]` | 求人詳細 | ✅ |
| `/login` | ログイン | ✅ |
| `/register` | 会員登録 | ⚠️ |
| `/application-confirm` | 応募確認 | ✅ |
| `/application-complete` | 応募完了 | ✅ |
| `/mypage` | マイページ | ✅ |
| `/mypage/profile` | プロフィール編集 | ✅ |
| `/mypage/applications` | 応募履歴 | ✅ |
| `/mypage/reviews` | レビュー管理 | ✅ |
| `/mypage/reviews/received` | 受け取ったレビュー | ✅ |
| `/messages` | メッセージ | ✅ |
| `/notifications` | 通知 | ✅ |
| `/bookmarks` | ブックマーク | ✅ |
| `/favorites` | お気に入り | ✅ |
| `/facilities/[id]` | 施設詳細 | ✅ |

### 4.2 施設管理者向け画面

| パス | 画面名 | 実装状況 |
|------|--------|----------|
| `/admin` | 求人一覧へリダイレクト | ✅ |
| `/admin/login` | ログイン | ✅ |
| `/admin/jobs` | 求人一覧 | ✅ |
| `/admin/jobs/new` | 求人作成 | ✅ |
| `/admin/jobs/[id]` | 求人詳細 | ✅ |
| `/admin/jobs/[id]/edit` | 求人編集 | ✅ |
| `/admin/jobs/templates` | テンプレート一覧 | ✅ |
| `/admin/jobs/templates/new` | テンプレート作成 | ✅ |
| `/admin/applications` | 応募者管理 | ✅ |
| `/admin/workers` | ワーカー一覧 | ✅ |
| `/admin/workers/[id]` | ワーカー詳細 | ✅ |
| `/admin/messages` | メッセージ | ✅ |
| `/admin/reviews` | レビュー一覧 | ✅ |
| `/admin/worker-reviews` | ワーカーレビュー | ✅ |
| `/admin/facility` | 施設情報 | ✅ |

---

## 5. 非機能要件

### 5.1 対応環境
- **ブラウザ**: Chrome, Safari, Firefox, Edge（最新版）
- **デバイス**: PC, タブレット, スマートフォン
- **レスポンシブ対応**: 必須

### 5.2 パフォーマンス目標
- ページ読み込み: 3秒以内
- API応答: 500ms以内

### 5.3 セキュリティ
- HTTPS通信
- パスワードハッシュ化（bcrypt）
- XSS/CSRF対策
- セッションタイムアウト（8時間）

### 5.4 キャンセルポリシー

**ワーカー側キャンセル**
- マッチング後24時間以降にキャンセル → **キャンセル率**に反映
- 勤務開始24時間以内にキャンセル → **直前キャンセル率**にも反映
- キャンセル率・直前キャンセル率は施設からワーカー詳細画面で確認可能
- ※キャンセル率が増える条件はシステム管理者機能で設定予定

**施設側キャンセル**
- 勤務開始時刻**前**までキャンセル可能
- 勤務開始時刻**以降**はキャンセル不可
- キャンセル時の通知:
  - メッセージ画面: システムメッセージとして「〇〇の求人がキャンセルされました」+ 未読バッジ
  - 仕事管理画面: 上部に通知バナー + フッターナビにバッジ
  - キャンセルされた仕事の詳細を開くと既読になりバッジが消える
- **ペナルティなし**: 施設からのキャンセルはキャンセル率に反映しない

**ペナルティ**
- 現状: キャンセル率が高いワーカーは施設から敬遠されやすくなる
- 将来: 低評価・高キャンセル率が続いた場合のアカウント制限をシステム管理者機能で設定予定

---

## 6. 技術スタック

### 6.1 フロントエンド
- **フレームワーク**: Next.js 14 (App Router)
- **言語**: TypeScript (strict mode)
- **スタイリング**: Tailwind CSS
- **アイコン**: Lucide React
- **通知**: React Hot Toast

### 6.2 バックエンド
- **API**: Next.js Server Actions
- **ORM**: Prisma
- **認証**: NextAuth.js (JWT)

### 6.3 データベース
- **DB**: PostgreSQL
- **実行環境**: Docker Compose

### 6.4 開発環境
- **パッケージ管理**: npm
- **リンター**: ESLint
- **型チェック**: TypeScript

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-12-04 | 実稼働システムから要件定義書を再作成 |
| 2025-12-05 | 応募・マッチング機能の再設計（即時マッチング、審査あり求人、募集人数制限、キャンセルルール改訂） |
