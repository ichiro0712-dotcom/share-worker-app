# 最低賃金バリデーション機能 - 要件定義書

**ステータス**: クライアント確認待ち
**作成日**: 2026-02-05
**確認予定日**: 2026-02-06

---

## 1. 機能概要

施設が求人を作成・編集する際、**都道府県ごとの最低賃金を下回る時給を設定できないようにする**機能。

### 1.1 背景・目的

- 法令遵守（最低賃金法）の担保
- 求人掲載時のコンプライアンスリスク軽減
- 施設管理者の入力ミス防止

---

## 2. 機能一覧

| No | 機能 | 対象ユーザー | 優先度 |
|----|------|-------------|--------|
| F-01 | 最低賃金マスタ管理（CSV一括更新） | システム管理者 | 高 |
| F-02 | 最低賃金マスタ管理（個別編集） | システム管理者 | 中 |
| F-03 | 適用開始日の設定 | システム管理者 | 高 |
| F-04 | 履歴管理・バックアップ（DB） | システム管理者 | 高 |
| F-05 | 履歴エクスポート（CSV） | システム管理者 | 中 |
| F-06 | 求人作成時のリアルタイムバリデーション | 施設管理者 | 高 |
| F-07 | 「最低賃金を適用」ボタン | 施設管理者 | 高 |
| F-08 | 求人保存時のブロック | 施設管理者 | 高 |

---

## 3. 詳細仕様

### 3.1 最低賃金マスタ管理（システム管理者向け）

#### 3.1.1 管理画面の場所

```
/system-admin/settings/minimum-wage
```

#### 3.1.2 CSVインポート仕様

**CSVフォーマット:**
```csv
都道府県,時給
北海道,1010
青森県,953
岩手県,952
...
東京都,1163
...
沖縄県,952
```

**入力許容形式:**

| 項目 | 許容形式 | 備考 |
|------|---------|------|
| 都道府県 | `東京都` / `東京` | 省略形も許容、内部で正規化 |
| 時給 | `1163` / `1,163` | カンマあり/なし両方許容 |

**バリデーション:**
- 47都道府県すべてが含まれていること（⚠️ 要確認：部分更新も許可するか？）
- 時給が正の整数であること
- 重複する都道府県がないこと

#### 3.1.3 適用開始日の設定

```
┌─────────────────────────────────────────────────────┐
│  適用開始日: [2026年10月1日 ▼]                      │
│                                                     │
│  ※ 指定日になると自動的に新しい最低賃金が適用されます │
└─────────────────────────────────────────────────────┘
```

**動作:**
- 現在日 < 適用開始日 → **現在の最低賃金**でバリデーション
- 現在日 ≥ 適用開始日 → **新しい最低賃金**でバリデーション
- 切り替えは自動（Cronや日次バッチ不要、取得時に日付判定）

#### 3.1.4 履歴管理

**DBへの自動バックアップ:**
- 新しいCSVをインポートすると、旧データは履歴テーブルに自動保存
- 保存される情報：都道府県、時給、適用開始日、適用終了日、アーカイブ日時

**CSVエクスポート:**
- 現在の最低賃金をCSVでダウンロード可能
- 履歴データもCSVでダウンロード可能

---

### 3.2 求人作成・編集時のバリデーション（施設管理者向け）

#### 3.2.1 バリデーションの判定基準

```
施設の都道府県（facility.prefecture）に基づいて最低賃金を取得
↓
入力された時給 < 最低賃金 → エラー
```

⚠️ **要確認**: 求人にも `prefecture` フィールドがあるが、施設の住所と求人の住所が異なる場合はどちらを基準にするか？

#### 3.2.2 UIの動作（時給入力フィールド）

**状態1: 入力前（初期状態）**
```
┌─────────────────────────────────────────────────────┐
│  時給 *                                              │
│  ┌─────────────────────────────────────────────────┐│
│  │                                            円  ││
│  └─────────────────────────────────────────────────┘│
│  ※ 東京都の最低賃金: 1,163円                        │
└─────────────────────────────────────────────────────┘
```
- 施設の都道府県に基づく最低賃金を**事前に表示**

**状態2: 最低賃金未満を入力してフォーカスアウト**
```
┌─────────────────────────────────────────────────────┐
│  時給 *                                              │
│  ┌─────────────────────────────────────────────────┐│
│  │ 1000                                       円  ││
│  └─────────────────────────────────────────────────┘│
│  ⚠️ 東京都の最低賃金（1,163円）を下回っています      │
│                                                     │
│  ┌──────────────────────┐                          │
│  │ 最低賃金を適用（1,163円）│ ← クリックで自動入力   │
│  └──────────────────────┘                          │
└─────────────────────────────────────────────────────┘
```
- 赤枠でエラー表示
- 「最低賃金を適用」ボタンを表示
- ボタンには具体的な金額を明記

**状態3: 「最低賃金を適用」ボタンをクリック**
```
┌─────────────────────────────────────────────────────┐
│  時給 *                                              │
│  ┌─────────────────────────────────────────────────┐│
│  │ 1163                                       円  ││
│  └─────────────────────────────────────────────────┘│
│  ※ 東京都の最低賃金: 1,163円                        │
└─────────────────────────────────────────────────────┘
```
- 時給フィールドに最低賃金を自動入力
- エラー表示が解消

#### 3.2.3 保存時のブロック

```
┌─────────────────────────────────────────────────────┐
│  ⛔ 求人を保存できません                             │
│                                                     │
│  以下の項目を修正してください：                       │
│  • 時給が東京都の最低賃金（1,163円）を下回っています  │
│                                                     │
│  ┌──────────────────────┐                          │
│  │ 最低賃金を適用（1,163円）│                        │
│  └──────────────────────┘                          │
└─────────────────────────────────────────────────────┘
```
- **完全ブロック**（例外なし）
- モーダルまたはトースト通知でエラーを表示
- 「最低賃金を適用」ボタンをここにも配置

---

## 4. データモデル（案）

```prisma
// 現在の最低賃金
model MinimumWage {
  id             Int       @id @default(autoincrement())
  prefecture     String    @unique  // 都道府県（正規化済み: "東京都"形式）
  hourly_wage    Int                // 時給（円）
  effective_from DateTime           // 適用開始日
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  @@map("minimum_wages")
}

// 最低賃金の履歴（バックアップ用）
model MinimumWageHistory {
  id             Int       @id @default(autoincrement())
  prefecture     String              // 都道府県
  hourly_wage    Int                 // 時給（円）
  effective_from DateTime            // 適用開始日
  effective_to   DateTime?           // 適用終了日（次の更新時に設定）
  archived_at    DateTime  @default(now())  // アーカイブ日時

  @@index([prefecture])
  @@map("minimum_wage_history")
}
```

---

## 5. API設計（案）

| エンドポイント | メソッド | 用途 | 認証 |
|---------------|---------|------|------|
| `/api/system-admin/minimum-wage` | GET | 最低賃金一覧取得 | システム管理者 |
| `/api/system-admin/minimum-wage` | POST | 最低賃金更新（単体） | システム管理者 |
| `/api/system-admin/minimum-wage/import` | POST | CSVインポート | システム管理者 |
| `/api/system-admin/minimum-wage/export` | GET | CSVエクスポート（現在値） | システム管理者 |
| `/api/system-admin/minimum-wage/history` | GET | 履歴一覧取得 | システム管理者 |
| `/api/system-admin/minimum-wage/history/export` | GET | 履歴CSVエクスポート | システム管理者 |
| `/api/minimum-wage/[prefecture]` | GET | 都道府県別最低賃金取得 | 施設管理者 |

---

## 6. 画面遷移・ワイヤーフレーム

### 6.1 システム管理画面: 最低賃金設定

```
┌─────────────────────────────────────────────────────────────────┐
│  最低賃金設定                                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─ CSVインポート ─────────────────────────────────────────────┐│
│  │                                                             ││
│  │  [ファイルを選択] sample.csv                                ││
│  │                                                             ││
│  │  適用開始日: [2026年10月1日 ▼]                              ││
│  │                                                             ││
│  │  [プレビュー] [インポート実行]                               ││
│  │                                                             ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                 │
│  現在の最低賃金一覧                    [CSVエクスポート]         │
│  ─────────────────────────────────────────────────────────────  │
│  │ 都道府県   │ 時給    │ 適用開始日  │ 操作     │              │
│  ├───────────┼────────┼────────────┼─────────┤              │
│  │ 北海道    │ ¥1,010 │ 2025/10/01 │ [編集]  │              │
│  │ 青森県    │ ¥953   │ 2025/10/01 │ [編集]  │              │
│  │ ...       │ ...    │ ...        │ ...     │              │
│  │ 東京都    │ ¥1,163 │ 2025/10/01 │ [編集]  │              │
│  │ ...       │ ...    │ ...        │ ...     │              │
│  │ 沖縄県    │ ¥952   │ 2025/10/01 │ [編集]  │              │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  [履歴を表示]                                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. クライアント確認事項（要回答）

以下の点について、クライアントに確認が必要です：

### 7.1 バリデーション基準

| No | 質問 | 選択肢 |
|----|------|--------|
| Q1 | 求人の時給バリデーションは**施設の住所**と**求人の住所**のどちらを基準にしますか？ | A) 施設の住所 / B) 求人の住所 / C) 両方の高い方 |
| Q2 | 求人に住所が未設定の場合はどうしますか？ | A) バリデーションをスキップ / B) 施設の住所を使用 / C) エラーにする |

### 7.2 CSVインポート

| No | 質問 | 選択肢 |
|----|------|--------|
| Q3 | CSVは47都道府県すべて必須ですか？部分更新も許可しますか？ | A) 47件すべて必須 / B) 部分更新も許可 |
| Q4 | CSVのヘッダー行は必須ですか？ | A) 必須 / B) なしでも許容 |

### 7.3 適用開始日

| No | 質問 | 選択肢 |
|----|------|--------|
| Q5 | 未来の適用開始日を設定した場合、管理画面にはどう表示しますか？ | A) 現在値のみ表示 / B) 現在値と予定値を両方表示 |
| Q6 | 過去の日付を適用開始日として設定できますか？ | A) 不可（未来日付のみ） / B) 可能（即時適用として扱う） |

### 7.4 エラーメッセージ

| No | 質問 | 選択肢 |
|----|------|--------|
| Q7 | エラーメッセージの文言は以下で問題ないですか？ | 「○○県の最低賃金（X,XXX円）を下回っています」 |

### 7.5 その他

| No | 質問 | 選択肢 |
|----|------|--------|
| Q8 | 初期データ（2025年度の最低賃金）は弊社で投入しますか？ | A) 弊社で投入 / B) クライアント側で投入 |
| Q9 | 最低賃金が変更された場合の通知は必要ですか？ | A) 不要 / B) システム管理者に通知 / C) 施設管理者にも通知 |

---

## 8. 実装スケジュール（案）

| フェーズ | 内容 | 見積もり |
|---------|------|---------|
| Phase 1 | データモデル・API設計 | - |
| Phase 2 | システム管理画面（CSV取込・履歴管理） | - |
| Phase 3 | 求人フォームのバリデーション実装 | - |
| Phase 4 | テスト・動作確認 | - |

※ 見積もりはクライアント確認後に算出

---

## 9. 変更履歴

| 日付 | 内容 | 担当 |
|------|------|------|
| 2026-02-05 | 初版作成 | - |

