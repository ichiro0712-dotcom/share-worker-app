# E2Eテストカバレッジレポート

> **最終更新**: 2025-01-01
> **テスト実行環境**: Playwright + Chromium

## テストサマリー

| カテゴリ | テスト数 | パス | 失敗 |
|---------|---------|-----|-----|
| ファイルアップロードバリデーション | 13 | 13 | 0 |
| メッセージ機能（ワーカー） | 12 | 12 | 0 |
| メッセージ機能（施設） | 12 | 12 | 0 |
| レビュー機能 | 9 | 9 | 0 |
| 求人承認フロー | 7 | 7 | 0 |
| 労働条件通知書 | 11 | 11 | 0 |
| **合計** | **64** | **64** | **0** |

---

## 1. ファイルアップロードバリデーション

**ファイル**: `tests/e2e/file-upload-validation.spec.ts`

### 検証される設定値

| フォーム | サイズ制限 | 許可形式 |
|---------|----------|---------|
| 求人・施設・プロフィール画像 | 20MB | image/* |
| 資格証明書・本人確認・通帳 | 20MB | image/*, .pdf |
| メッセージ添付 | 15MB | image/*, pdf, doc, xlsx等 |
| ご利用ガイド | 100MB | .pdf |

### テスト一覧

| テスト名 | 対象画面 | 検証内容 |
|---------|---------|---------|
| 求人画像 - 20MB超過 | /admin/jobs/new | サイズ超過エラー表示 |
| 求人画像 - 無効形式 | /admin/jobs/new | .exe等の拒否 |
| 求人画像 - 有効ファイル | /admin/jobs/new | 正常アップロード |
| 施設画像 - 20MB超過 | /admin/facility | サイズ超過エラー表示 |
| 施設画像 - 無効形式 | /admin/facility | 無効形式の拒否 |
| プロフィール画像 - 20MB超過 | /mypage/profile | サイズ超過エラー表示 |
| プロフィール画像 - 無効形式 | /mypage/profile | .exe等の拒否 |
| 資格証明書 - 20MB超過 | /mypage/profile | サイズ超過エラー表示 |
| 資格証明書 - 無効形式 | /mypage/profile | .exe等の拒否 |
| 資格証明書 - 有効PDF | /mypage/profile | PDF正常アップロード |
| 本人確認書類 - 20MB超過 | /mypage/profile | サイズ超過エラー表示 |
| 通帳画像 - 20MB超過 | /mypage/profile | サイズ超過エラー表示 |
| ワーカー登録 - 20MB超過 | /register/worker | サイズ超過エラー表示 |

---

## 2. メッセージ機能

### ワーカー側 (`tests/e2e/worker/messages.spec.ts`)

| テスト名 | 検証内容 |
|---------|---------|
| メッセージ一覧表示 | 会話リストの表示確認 |
| 会話を開く | 会話詳細への遷移 |
| メッセージ送信 | テキスト送信と反映 |
| ファイル添付UI | 添付ボタン/入力欄の存在 |
| 15MB超過エラー | サイズ超過時のエラー表示 |
| 無効形式エラー | .exe等の拒否 |
| 空状態表示 | メッセージなし時の表示 |

### 施設側 (`tests/e2e/facility/messages.spec.ts`)

| テスト名 | 検証内容 |
|---------|---------|
| メッセージ一覧表示 | 会話リストの表示確認 |
| 会話を開く | 会話詳細への遷移 |
| メッセージ送信 | テキスト送信と反映 |
| ファイル添付UI | 添付ボタン/入力欄の存在 |
| 15MB超過エラー | サイズ超過時のエラー表示 |
| 無効形式エラー | .exe等の拒否 |
| 空状態表示 | メッセージなし時の表示 |

---

## 3. レビュー機能

**ファイル**: `tests/e2e/worker/reviews.spec.ts`

### 前提条件

テスト実行前に `ensureReviewPrerequisites()` で以下を作成:
- 評価待ち用の応募（COMPLETED_PENDING + worker_review_status=PENDING）
- 投稿済みレビュー（reviewer_type=WORKER）
- 受け取ったレビュー（reviewer_type=FACILITY）

### テスト一覧

| テスト名 | 対象画面 | 検証内容 |
|---------|---------|---------|
| レビューページ表示 | /mypage/reviews | ページ表示確認 |
| 評価待ち一覧 | /mypage/reviews | 未評価の応募表示 |
| 投稿済み一覧 | /mypage/reviews | 投稿済みレビュー表示 |
| レビュー作成ページ遷移 | /mypage/reviews/[id] | フォーム表示 |
| 星評価入力欄 | /mypage/reviews/[id] | 評価UI表示 |
| コメント入力欄 | /mypage/reviews/[id] | テキストエリア表示 |
| 送信ボタン | /mypage/reviews/[id] | ボタン表示 |
| 受け取ったレビュー | /mypage/reviews/received | レビュー内容表示 |
| マイページからナビゲーション | /mypage | リンク遷移確認 |

---

## 4. 求人承認フロー

**ファイル**: `tests/e2e/flows/job-approval-flow.spec.ts`

### フロー概要

```
施設管理者: 求人作成 → 公開
    ↓
ワーカー: 求人検索 → 応募
    ↓
施設管理者: 応募確認 → マッチング承認
    ↓
両者: マッチング成立確認
```

### テスト一覧

| テスト名 | 検証内容 |
|---------|---------|
| 施設ログイン | 施設管理者ログイン成功 |
| 求人作成 | 必須項目入力、公開確認 |
| 求人公開確認 | 一覧での表示確認 |
| ワーカー応募 | 検索→応募完了 |
| 応募確認 | 施設側で応募表示 |
| マッチング承認 | 承認操作、ステータス更新 |
| マッチング成立確認 | 両者でステータス確認 |

---

## 5. 労働条件通知書

**ファイル**: `tests/e2e/labor-document.spec.ts`

### ワーカー側テスト

| テスト名 | 対象画面 | 検証内容 |
|---------|---------|---------|
| 仕事管理ページ遷移 | /my-jobs | ナビゲーション確認 |
| 仕事一覧表示 | /my-jobs | ヘッダー、戻るリンク |
| 仕事詳細表示 | /my-jobs/[id] | 勤務情報、施設情報 |
| 労働条件通知書リンク | /my-jobs/[id] | マッチング済みでリンク表示 |
| 労働条件通知書表示 | 通知書ページ | 必須セクション表示 |
| 必須項目確認 | 通知書ページ | 労基法準拠項目 |

### 施設管理者側テスト

| テスト名 | 対象画面 | 検証内容 |
|---------|---------|---------|
| ワーカー詳細リンク | /admin/workers/[id] | 通知書リンク表示 |
| 通知書一覧 | 通知書一覧ページ | ページ表示確認 |
| 印刷ボタン | 通知書詳細ページ | 印刷ボタン表示 |

---

## 未テスト項目（要追加）

### デバッグシートからの優先対応項目

| ID | カテゴリ | 優先度 | 内容 | テスト提案 |
|----|---------|-------|------|-----------|
| 72 | バグ | 緊急 | ソート機能の不具合 | 求人一覧ソートテスト |
| 73 | バグ | 緊急 | フリガナ自動入力問題 | 入力バリデーションテスト |
| 67 | バグ | 調査中 | 求人表示の遅延 | パフォーマンステスト |
| 71 | その他 | 緊急 | メール・通知機能 | 通知送信テスト |

### bugfix-checklist.md からの未テスト項目

| # | 機能 | テスト提案 |
|---|------|-----------|
| 3 | 新規ワーカー登録 | 登録フロー完全テスト |
| 4 | プロフィール保存 | 各フィールド保存確認 |
| 8 | 必須項目バリデーションUI | 赤枠表示テスト |
| 9 | 法人番号必須化 | 13桁バリデーションテスト |
| 12 | 郵便番号→住所自動入力 | AddressSelectorテスト |
| 13 | 入力フィールドバリデーション | カナ変換、電話番号フォーマット |

---

## テスト実行方法

```bash
# 全テスト実行
npm run test:e2e

# 特定ファイルのみ
npx playwright test tests/e2e/file-upload-validation.spec.ts

# UIモードで実行
npx playwright test --ui

# HTMLレポート生成
npx playwright test
npx playwright show-report reports/playwright
```

---

## 関連ドキュメント

- [メッセージテストワークフロー](./messages-tests-workflow.md)
- [レビュー前提条件](./reviews-prerequisites.md)
- [バグ修正チェックリスト](../bugfix-checklist.md)
