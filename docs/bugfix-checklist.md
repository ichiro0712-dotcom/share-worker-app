# バグ修正・機能改善チェックリスト

> **作成日**: 2024年12月20日
> **進め方**: ローカルで確認 → ユーザー確認 → 本番デプロイ → 本番確認 → 次のタスクへ

## ⚠️ 作業ルール（重要）

**1つずつ完璧に本番環境で確認が済むまでやる。ユーザーの指示があるまで次のタスクに進まない。**

- Claude Codeは1タスクの修正が完了したら**必ず停止してユーザーに報告**
- ユーザーがローカル確認 → 本番デプロイ → 本番確認を行う
- ユーザーが「次に進んで」と指示するまで次のタスクに着手しない
- 勝手に複数タスクを同時進行しない

## 進捗サマリー

| # | タスク | ステータス | ローカル | 本番 |
|---|--------|-----------|---------|------|
| 1 | デバッグ用エラー通知機能 | ✅ 完了（全ファイル適用済み） | ✅ | ✅ |
| 2 | 写真アップロード全体確認・修正 | ✅ 完了 | ✅ | ✅ |
| 3 | 新規ワーカー/施設登録の確認・修正 | ✅ 完了（楽観的UI導入） | ✅ | ✅ |
| 4 | プロフィール保存問題（1,2,3完了後に確認） | ✅ 完了（ユーザー確認済み） | ✅ | ✅ |
| 5 | マッチング成立日程の表示改善 | ✅ 完了（通知メッセージで対応済み） | ✅ | ✅ |
| 6 | 希望時刻等のデフォルト値変更 | ✅ 完了（特になしに変更） | ✅ | ⬜ |
| 7 | ログイン画面のロゴ表示修正 | ✅ 完了（gitignore修正） | ✅ | ⬜ |
| 8 | 必須項目バリデーションUI改善 | ⬜ 未着手 | ⬜ | ⬜ |
| 9 | 法人番号の必須化 | ✅ 完了（13桁バリデーション付き） | ✅ | ✅ |
| 10 | 担当者挨拶文のプレースホルダー追加 | ✅ 完了（180文字制限・カウンター付き） | ✅ | ✅ |
| 11 | 求人詳細ページのレイアウト修正 | ⬜ 未着手 | ⬜ | ⬜ |
| 12 | 郵便番号から住所自動入力 | ✅ 完了（AddressSelectorに実装済み） | ✅ | ✅ |
| 13 | 入力フィールドバリデーション強化 | ⬜ 未着手 | ⬜ | ⬜ |
| 14 | 施設管理画面のリンク表示問題 | ⬜ 未着手 | ⬜ | ⬜ |
| 15 | ワーカー登録時の資格・資格画像必須化 | ⬜ 未着手 | ⬜ | ⬜ |
| 16 | 性別選択の改善（その他削除、ラベル変更） | ⬜ 未着手 | ⬜ | ⬜ |

---

## タスク詳細

### #1 デバッグ用エラー通知機能 ✅ 完了

**目的**: 保存・更新失敗時にエラー内容をヘッダーに表示（×で閉じるまで表示）

**実装内容**:
- `components/debug/DebugErrorBanner.tsx` を作成
  - ヘッダー固定のデバッグバナー
  - エラータイプ（保存/更新/削除/取得/アップロード/その他）
  - 操作名、エラーメッセージ、詳細、スタックトレース表示
  - コンテキスト情報（FormDataの内容など）
  - ×ボタンで個別に閉じられる、「すべてクリア」ボタン
  - コピー機能（JSONでクリップボードにコピー）
  - **DEBUG_MODE フラグ**で本番リリース前に無効化可能

- 適用済み画面:
  - [x] `app/mypage/profile/ProfileEditClient.tsx` - プロフィール更新
  - [x] `app/register/worker/page.tsx` - 新規ワーカー登録
  - [x] `app/admin/facility/page.tsx` - 施設情報保存

**本番リリース前の作業**:
`components/debug/DebugErrorBanner.tsx` の `DEBUG_MODE` を `false` に変更

**ステータス**: ✅ 完了（ローカル確認待ち）

---

### #2 写真アップロード全体確認・修正 🔄 修正済み

**目的**: 全ての画像アップロード機能を正常化

**調査結果**:
| 機能 | 使用API | 問題 |
|------|---------|------|
| プロフィール画像 | 直接Supabase | ✅ 問題なし |
| 資格証明書 | 直接Supabase | ✅ 問題なし |
| 身分証明書・通帳コピー | 直接Supabase | ✅ 問題なし |
| **担当者写真（施設）** | `/api/upload` | ⚠️ **修正済み** |
| **求人画像** | `/api/upload` | ⚠️ **修正済み** |
| メッセージ添付 | `/api/upload` | ✅ 問題なし |

**修正内容**:
- `app/api/upload/route.ts` のデフォルトファイルサイズ制限を **5MB → 20MB** に変更
- クライアント側（`utils/fileValidation.ts`）と同期

**確認項目**:
- [ ] プロフィール写真アップロード
- [ ] 資格証明書アップロード
- [ ] 担当者写真アップロード（施設管理）
- [ ] 求人画像アップロード

**ステータス**: 🔄 修正済み（ローカル確認待ち）

---

### #3 新規ワーカー/施設登録の確認・修正 🔄 修正済み

**目的**: 新規登録フローを完璧な状態に

**調査結果**:
- ワーカー新規登録: 動作OK（ユーザー確認済み）
- 施設新規登録: 意図的にシステム管理者限定（セルフサインアップなし）

**修正内容** (`app/register/worker/page.tsx`):
1. ✅ メールアドレス形式チェック追加
2. ✅ 電話番号形式チェック追加（10桁または11桁、ハイフン可）
3. ✅ 画像圧縮中の送信防止（ボタン無効化 + エラーメッセージ）

**確認項目**:
- [ ] 新規ワーカー登録（バリデーション動作確認）
- [x] 新規施設登録（管理者限定のため対象外）

**ステータス**: 🔄 修正済み（ローカル確認待ち）

---

### #4 プロフィール保存問題

**URL**: https://s-work.netlify.app/mypage/profile?returnUrl=%2Fjobs%2F244

**現象**: 応募に進み、個人情報を入れたが、エラーも出ず、登録も出来ない

**対応方針**: #1, #2, #3 完了後に確認。それで直っていれば完了。

**ステータス**: ⬜ 未着手

---

### #5 マッチング成立日程の表示改善

**現象**: 求人の子求人に2日応募したが、どの日に応募したかわからない

**対応方針**:
1. 現在どこで表示されるようになっているか確認
2. 足りなければ表示を変えるか増やす

**ステータス**: ⬜ 未着手

---

### #6 希望時刻等のデフォルト値変更 ✅ 完了

**URL**: /mypage/profile

**変更対象**:
- [x] 希望開始時刻: 「選択してください」→「特になし」
- [x] 希望終了時刻: 「選択してください」→「特になし」
- [x] その他希望勤務日数: 「選択してください」→「特になし」
- [x] 希望勤務期間: 「選択してください」→「特になし」

**実装内容**:
- `app/mypage/profile/ProfileEditClient.tsx` の4つのドロップダウンのデフォルト選択肢を変更

**ステータス**: ✅ 完了（ローカル確認待ち）

---

### #7 ログイン画面のロゴ表示修正 ✅ 完了

**URL**: /login

**現象**: 本番環境でロゴ画像が壊れて表示されない（ローカルでは表示される）

**原因**: `.gitignore`に`rogo/`が含まれていたため、ロゴファイルがgitにコミットされず、本番環境にデプロイされていなかった

**修正内容**:
- `.gitignore`から`rogo/`を削除
- `public/rogo/`ディレクトリ内の全ロゴファイルをgitに追加
  - rogo1.png〜rogo7.png, rogo5.jpg

**ステータス**: ✅ 完了（デプロイ待ち）

---

### #8 必須項目バリデーションUI改善

**目的**: 必須項目が未入力の場合、視覚的にわかりやすく表示

**要件**:
- 入力欄を赤く縁取る
- 最新のUI/UXベストプラクティスを調査して適用

**対象画面**: 調査して全ての登録・編集画面を特定
- ワーカー側
- 施設側

**ステータス**: ⬜ 未着手

---

### #9 法人番号の必須化 ✅ 完了

**場所**: 施設管理画面 > 施設管理 > 法人情報

**要件**:
- 法人番号フィールドを追加（13桁の数字）
- 必須項目として設定
- DBにカラム追加

**実装内容**:
- `app/admin/facility/page.tsx` に法人番号入力欄追加
- 13桁数字バリデーション（保存時チェック）
- `prisma/schema.prisma` に `corporate_number` フィールド追加
- 既存施設は後から入力可能

**ステータス**: ✅ 完了

---

### #10 担当者挨拶文のプレースホルダー追加 ✅ 完了

**場所**: 施設管理画面 > 施設管理 > 法人情報 > 施設情報・担当者 > 担当者 > 挨拶文、注意書き

**要件**:
- プレースホルダー: 「求人情報に掲載されます。施設のイメージや働き方、良いところ等を記載すると募集が増えます」
- 180文字制限（必須）
- 文字数カウンター表示

**実装内容**:
- `app/admin/facility/page.tsx` の担当者挨拶文テキストエリアにプレースホルダー追加
- 180文字上限設定（maxLength）
- 文字数カウンター表示（「○○/180文字」形式）

**ステータス**: ✅ 完了

---

### #11 求人詳細ページのレイアウト修正

**URL**: https://s-work.netlify.app/jobs/243

**現象**: 責任者のコンテンツから下、余白がなく左に寄りすぎ（スマホ表示）

**確認**: ローカルでも同じ現象

**ステータス**: ⬜ 未着手

---

### #12 郵便番号から住所自動入力

**目的**: 郵便番号入力で都道府県・市区町村を自動入力

**対象画面**: 調査して全ての住所入力画面を特定
- ワーカー登録
- 施設登録
- その他

**ステータス**: ⬜ 未着手

---

### #13 入力フィールドバリデーション強化

**目的**: 各入力フィールドで適切な入力制限とフォーマット

**対象**:
- [ ] カナ: カタカナのみ入力可
- [ ] 電話番号: 数字のみ、ハイフン自動挿入、10桁または11桁
- [ ] メールアドレス: 適切なフォーマットチェック
- [ ] その他: 調査して追加

**最新UI/UX調査**: ベストプラクティスを調べて適用

**ステータス**: ⬜ 未着手

---

### #14 施設管理画面のリンク表示問題

**URL**: https://s-work.netlify.app/admin/workers/1/certificates

**現象**:
- 資格証明書写真リンクを押しても表示されない
- 緊急連絡先を押しても表示されない

**確認**: やる時にローカルでも確認

**ステータス**: ⬜ 未着手

---

### #15 ワーカー登録時の資格・資格画像必須化

**目的**: ワーカー登録時に資格登録、資格の画像登録を必須に

**詳細**: 実装時に決定

**ステータス**: ⬜ 未着手

---

### #16 性別選択の改善

**目的**: ジェンダー配慮

**要件**:
- 「その他」選択肢を削除
- ラベルを「性別」→「性別（出生時）」に変更

**対象画面**: 調査して全ての性別入力箇所を特定

**ステータス**: ⬜ 未着手

---

## 作業ログ

### 2024-12-20
- チェックリスト作成
- 優先順位決定: #1 → #2 → #3 → #4確認 → 以降順次
- #1〜#3 完了
- #9 法人番号必須化 完了
- #10 担当者挨拶文プレースホルダー 完了
- #12 郵便番号から住所自動入力 完了（AddressSelectorコンポーネントに実装済み）
- 追加実装:
  - 施設住所「法人住所と同じ」チェックボックス追加
  - 新規施設作成時の通知先メール自動設定
  - ワーカー登録の楽観的UI導入
  - 入力欄サイズの統一化（AddressSelector）
  - フォームレイアウト改善（代表者/担当者情報の分離）
