# S WORKS - 開発ログ

このファイルはS WORKSプロジェクトの実装状況、変更履歴、重要な決定事項を記録します。

---

## 目次

1. [実装状況](#実装状況)
2. [変更履歴](#変更履歴)
3. [既知の課題](#既知の課題)

---

## 実装状況

### プロジェクト構成

```
share-worker-app/
├── app/                           # Next.js App Router
│   ├── page.tsx                   # テストインデックス（/test/indexに移動予定）
│   ├── job-list/                  # 求人一覧（/に変更予定）
│   ├── jobs/[id]/                 # 求人詳細
│   ├── favorites/                 # お気に入り
│   ├── messages/                  # メッセージ
│   ├── my-jobs/                   # 仕事管理
│   ├── mypage/                    # マイページ
│   ├── test-index/                # テストインデックス
│   └── admin/                     # 施設管理画面
│       ├── jobs/                  # 求人管理
│       ├── workers/               # ワーカー管理
│       ├── messages/              # メッセージ
│       ├── facility/              # 施設情報
│       └── privacy/, terms/       # プライバシー、利用規約
├── components/                    # コンポーネント
│   ├── layout/                    # レイアウト
│   │   ├── BottomNav.tsx          # 下部ナビゲーション（5項目）
│   ├── admin/                     # 管理画面コンポーネント
│   │   └── AdminLayout.tsx        # 管理画面レイアウト
│   └── job/                       # 求人関連コンポーネント
│       ├── JobCard.tsx
│       ├── FilterModal.tsx
│       └── ...
├── types/                         # 型定義
│   ├── job.ts
│   ├── facility.ts
│   ├── worker.ts
│   └── ...
├── data/                          # ダミーデータ
│   ├── jobs.ts                    # 求人データ（50件）
│   ├── facilities.ts              # 施設データ（30件）
│   ├── jobTemplates.ts            # テンプレートデータ（10件）
│   └── ...
├── docs/                          # 旧ドキュメント（アーカイブ予定）
│   ├── requirements.md
│   ├── screen-specification.md
│   └── PHASE1_PLAN.md
├── PROJECT_SPEC.md                # プロジェクト仕様書（統合版）
├── DEVELOPMENT_LOG.md             # 開発ログ（本ファイル）
├── CHANGELOG.md                   # 変更履歴
└── README.md                      # プロジェクト概要
```

---

### 実装済み機能

#### ワーカー側

##### ✅ トップページ（求人一覧） `/job-list`
- タブ切り替え（全体/限定/指名）
- 日付スライダー（今日から90日分）
- 並び順変更（近い順/時給順/締切が近い順）
- 求人カード表示（50件のダミーデータ）
- フィルターモーダル
  - 勤務時間帯（朝/昼/夜/夜勤）
  - サービス種別（デイサービス/特養/有料老人ホーム等）
  - 職種（看護/介護）
  - タグ検索
- 下部ナビゲーション（5項目）

##### ✅ 求人詳細ページ `/jobs/[id]`
- 画像カルーセル
- 施設基本情報（名前、評価、住所、アクセス、地図）
- お仕事カード（横スクロール、同じ施設の他の日程）
- 責任者情報
- 仕事内容
- レビュー表示
- タブナビゲーション（仕事概要/申込条件/事前情報/レビュー）
- 申し込みボタン

##### ✅ 仕事管理ページ `/my-jobs`
- ステータス別タブ（scheduled/working/completed_pending/completed_rated/cancelled）
- コンパクト求人カード（2.3列分の高さ）
  - 施設画像、施設名、評価
  - 勤務日時
  - 時給・交通費・総支給額（1行表示）
  - アクションボタン
    - scheduled/working: キャンセル、メッセージ
    - completed_pending: 評価する、メッセージ
    - completed_rated/cancelled: メッセージのみ
- メッセージボタン機能
  - クリック時に `/messages?roomId={施設名}` に遷移

##### ✅ メッセージページ `/messages`
- タブ切り替え（メッセージ/お知らせ）
- メッセージタブ機能
  - 施設名検索
  - ソート機能（新着順/勤務日順）リスト選択形式
  - メッセージルーム一覧
  - URLパラメータ対応 `?roomId={施設名}` で直接チャット開く
- お知らせタブ（検索・ソート機能なし）

##### ✅ お気に入りページ `/favorites`
- お気に入り登録した求人一覧
- 求人カード表示

##### ✅ マイページ `/mypage`
- プロフィール表示
- 編集機能

##### ✅ 下部ナビゲーション `/components/layout/BottomNav.tsx`
- 5項目表示
  1. 探す (`/job-list`)
  2. お気に入り (`/favorites`)
  3. メッセージ (`/messages`)
  4. 仕事管理 (`/my-jobs`)
  5. マイページ (`/mypage`)
- アクティブ状態の表示（緑色）
- 未読バッジ表示機能（メッセージ）

#### 施設側

##### ✅ 施設管理画面 `/admin`
- サイドバーナビゲーション
  - ダッシュボード
  - 求人管理
  - テンプレート管理
  - ワーカー管理
  - メッセージ
  - 施設情報
  - ログアウト

##### ✅ 求人管理 `/admin/jobs`
- 求人一覧表示
- ステータスフィルター
- 新規求人作成ボタン
- 各求人の編集・削除・複製

##### ✅ 求人作成 `/admin/jobs/new`
- テンプレート選択（任意）
- 勤務日時入力
- 募集人数、職種、業務内容
- 報酬、交通費
- 施設情報、画像
- プレビュー・公開

##### ✅ テンプレート管理 `/admin/jobs/templates`
- テンプレート一覧（10件のダミーデータ）
- 新規テンプレート作成ボタン
- 各テンプレートの編集・削除・複製

##### ✅ テンプレート作成 `/admin/jobs/templates/new`
- テンプレート名、求人タイトル
- 勤務時間（開始/終了/休憩）
- 時給、交通費
- 募集人数
- 必要資格
- 仕事内容
- スキル・経験（5件まで）
- 服装・身だしなみ（5件まで）
- 持ち物・その他（5件まで）
- デフォルト画像設定
- 備考、タグ

##### ✅ テンプレート編集 `/admin/jobs/templates/[id]/edit`
- テンプレート作成と同じフォーム
- **5件制限実装済み**
  - スキル・経験: ラベルに「（5つまで入力可能）」、`disabled={formData.skills.length >= 5}`
  - 服装・身だしなみ: ラベルに「（5つまで入力可能）」、`disabled={formData.dresscode.length >= 5}`
  - 持ち物・その他: ラベルに「（5つまで入力可能）」、`disabled={formData.belongings.length >= 5}`
  - `addToArray` 関数内で5件チェック

##### ✅ ワーカー管理 `/admin/workers`
- マッチング済みワーカー一覧（`applied` ステータスは除外）
- ステータスフィルター
- ワーカー詳細表示
- メッセージ送信
- お気に入り・あとで見る機能

##### ✅ メッセージページ `/admin/messages`
- ワーカーとのメッセージルーム一覧
- ワーカー検索機能

##### ✅ 施設情報管理 `/admin/facility`
- 施設基本情報編集
- 法人情報編集
- 施設画像管理

---

### 未実装機能（Phase 2以降）

#### 認証・セキュリティ
- [ ] ユーザー登録・ログイン
- [ ] SNS連携（Google、LINE）
- [ ] JWT認証
- [ ] パスワードリセット

#### データベース連携
- [ ] PostgreSQL接続
- [ ] API エンドポイント
- [ ] データ永続化

#### 応募フロー
- [ ] プロフィール完成度チェック
- [ ] 応募確認画面
- [ ] 応募処理（実際のDB保存）
- [ ] 確認メール送信

#### 評価システム
- [ ] 双方向評価フォーム
- [ ] 評価状態管理（`worker_review_status`, `facility_review_status`）
- [ ] 評価完了時のステータス更新

#### メッセージ機能
- [ ] リアルタイムメッセージング
- [ ] マッチング時の自動メッセージ送信（施設の初回メッセージ設定を使用）
- [ ] 未読管理
- [ ] 通知機能

#### お気に入り・ブックマーク
- [ ] お気に入り保存（DB連携）
- [ ] あとで見る保存（DB連携）
- [ ] ワーカー側：ブックマーク機能の廃止（お気に入りに統一）
- [ ] 施設側：お気に入りとあとで見る両方実装

#### その他
- [ ] Google Maps API連携
- [ ] 位置情報ベースのソート
- [ ] プッシュ通知
- [ ] 画像アップロード機能
- [ ] 決済機能（Stripe）

---

## 変更履歴

### [2025-11-24] - 用語統一とドキュメント整理（作業中）

#### 変更内容
1. **ドキュメント統合**
   - 5つのドキュメントファイルを2つに統合
     - `PROJECT_SPEC.md`: 完全な仕様書
     - `DEVELOPMENT_LOG.md`: 実装状況と変更履歴（本ファイル）
   - 旧ドキュメントは `docs/archive/` に移動予定

2. **用語統一（作業予定）**
   - "事業所" → "施設" に全て変更
   - "案件" → "求人" に全て変更
   - 対象ファイル: 全コードファイル、ドキュメント

3. **評価フロー変更（作業予定）**
   - 双方向評価システムの実装
   - `WorkerStatus` 型の更新
   - `Application` テーブルに評価状態フィールド追加
     - `worker_review_status: 'pending' | 'completed'`
     - `facility_review_status: 'pending' | 'completed'`

4. **ルーティング変更（作業予定）**
   - `/` をトップページ（求人一覧）に変更
   - 現在のテストインデックスを `/test/index` に移動

5. **ブックマーク機能整理（作業予定）**
   - ワーカー側：ブックマーク廃止、お気に入りに統一
   - 施設側：お気に入りとあとで見る両方を保持

#### 変更理由
- 現在の実装コードが正解（ドキュメントを実装に合わせる方針）
- 用語の混乱を解消し、仕様の一貫性を保つ
- コンテキストウィンドウの効率化（ドキュメント統合）

---

### [2025-11-18] - テンプレート編集ページの5件制限対応

#### 変更内容
テンプレート編集ページで「スキル・経験」「服装・身だしなみ」「持ち物・その他」フィールドに5件制限を追加

#### 変更理由
- テンプレート作成ページには既に5件制限が実装済みだったが、編集ページには未実装だった
- 作成と編集で仕様を統一し、データの一貫性を保つため
- ユーザーに対して明確な制限を示し、無制限に項目が追加されることを防ぐ

#### 修正されたファイル

**テンプレート編集ページ**
- `/app/admin/jobs/templates/[id]/edit/page.tsx`
  - `addToArray`関数に5件制限のロジックを追加
  - スキル・経験フィールド:
    - ラベルに「（5つまで入力可能）」を追加
    - 入力フィールドとボタンに`disabled={formData.skills.length >= 5}`を追加
  - 服装・身だしなみフィールド:
    - ラベルに「（5つまで入力可能）」を追加
    - 入力フィールドとボタンに`disabled={formData.dresscode.length >= 5}`を追加
  - 持ち物・その他フィールド:
    - ラベルに「（5つまで入力可能）」を追加
    - 入力フィールドとボタンに`disabled={formData.belongings.length >= 5}`を追加

#### 後方互換性
- 既存のダミーデータ（全10テンプレート）は全て5件または6件のデータを持っているが、表示には影響なし
- 編集時は5件制限が適用され、6件目以降は追加不可

#### 確認事項
- 全10テンプレートのダミーデータに画像パス（`images`フィールド）が既に設定済みであることを確認

---

### [2025-11-18] - テンプレートアーキテクチャの修正

#### 変更内容
**重要なアーキテクチャ変更**: テンプレートシステムを企業全体ベースから施設ベースに変更

#### 変更理由
- 初期設計では、テンプレートが企業全体で共有されていた（`facilityId`フィールドがなかった）
- 正しい仕様: テンプレートは各施設に紐づき、施設ごとに管理される
- 施設管理画面は**1施設が使う管理画面**であり、複数施設を管理するものではない
- 求人作成時に、施設が自分のテンプレートから選択する

#### 修正されたファイル

**データ構造**
- `/data/jobTemplates.ts`
  - `JobTemplate`インターフェースに`facilityId`フィールドを追加（または追加予定）
  - 全10テンプレートに施設IDを設定（または設定予定）

**UI コンポーネント**
- `/app/admin/jobs/templates/page.tsx`
  - 施設フィルター機能（1施設のみなので不要、自動フィルター）

- `/app/admin/jobs/templates/new/page.tsx`
  - 施設選択ドロップダウン不要（自施設のテンプレートのみ作成）

- `/app/admin/jobs/templates/[id]/edit/page.tsx`
  - 施設選択ドロップダウン不要（自施設のテンプレートのみ編集）

- `/app/admin/jobs/new/page.tsx`
  - テンプレート選択を自施設のテンプレートのみに限定
  - `availableTemplates = jobTemplates.filter(t => t.facilityId === currentFacilityId)`

**ドキュメント**
- `/docs/requirements.md`
  - テンプレート機能セクションを更新
  - `JobTemplates`テーブル定義に`facility_id`フィールドを追加
  - `Jobs`テーブルに`template_id`フィールドの説明を追加

- `/docs/PHASE1_PLAN.md`
  - `JobTemplate`インターフェース定義に`facilityId`を追加
  - `Job`インターフェースに`templateId`フィールドの説明を追加
  - ダミーデータ作成ステップにテンプレートデータを更新

**クリーンアップ**
- `/requirements.md` (ルート) - 削除（重複ファイル、`/docs/requirements.md`と同一内容）

#### データベースへの影響（将来）
Phase 2以降でデータベースを実装する際:
- `job_templates`テーブルに`facility_id`カラムを追加（NOT NULL、外部キー制約）
- `jobs`テーブルに`template_id`カラムを追加（NULL許容、外部キー制約）

#### 後方互換性
- 既存のダミーデータは互換性があるよう更新済み（または更新予定）
- UIは新しいアーキテクチャで正常に動作

---

### [2025-11-XX] - メッセージ機能とコンパクトカードデザイン

#### 変更内容
1. **仕事管理ページのコンパクトカードデザイン**
   - カードの縦幅を短縮（2.3列分が画面に表示）
   - 時給・交通費・総支給額を1行に表示

2. **メッセージページの機能追加**
   - 施設名検索機能
   - ソート機能（新着順/勤務日順）リスト選択形式
   - タブ切り替え（メッセージ/お知らせ）

3. **メッセージボタンからの遷移**
   - 仕事管理ページのメッセージボタンから `/messages?roomId={施設名}` に遷移
   - メッセージページで自動的にその施設のチャットルームを開く

#### 変更理由
- ユーザビリティの向上
- 画面遷移の効率化
- 必要な情報を1画面に収める

#### 修正されたファイル
- `/app/my-jobs/page.tsx`
  - カードデザインの変更
  - 時給・交通費・総支給額の1行表示

- `/app/messages/page.tsx`
  - 施設名検索機能追加
  - ソート機能追加（新着順/勤務日順）
  - URLパラメータ `?roomId` 対応

- `/components/layout/BottomNav.tsx`
  - マイページ項目の復活（5項目表示）

---

### [2025-11-XX] - 下部ナビゲーションのマイページ復活

#### 変更内容
下部ナビゲーションにマイページを追加（5項目表示）

#### 変更理由
- マイページが誤って削除されていた
- 仕様書通り5項目の下部ナビゲーションに戻す

#### 修正されたファイル
- `/components/layout/BottomNav.tsx`
  - `User` アイコンのインポート追加
  - マイページ項目を `navItems` 配列に追加

---

## 既知の課題

### 優先度: 高

1. **用語の不統一**
   - "事業所" と "施設" が混在している → 全て "施設" に統一する必要あり
   - "案件" と "求人" が混在している → 全て "求人" に統一する必要あり
   - 影響ファイル: 約14ファイル（コード、ドキュメント）

2. **評価システムの未実装**
   - 双方向評価（ワーカー→施設、施設→ワーカー）が未実装
   - `WorkerStatus` 型に評価状態フィールドがない
   - `Application` データ構造の更新が必要

3. **ルーティングの変更**
   - `/` が現在テストインデックス → 求人一覧にする必要あり
   - テストインデックスを `/test/index` に移動する必要あり

4. **ブックマーク機能の整理**
   - ワーカー側：ブックマークとお気に入りが混在 → お気に入りに統一する必要あり
   - 施設側：仕様の明確化が必要

### 優先度: 中

5. **データベース連携**
   - 現在はダミーデータのみ
   - PostgreSQL接続とAPI実装が必要

6. **認証システム**
   - ログイン・会員登録機能が未実装
   - JWT認証の実装が必要

7. **リアルタイムメッセージング**
   - 現在は静的なダミーデータ
   - WebSocket または Pusher の実装が必要

### 優先度: 低

8. **画像アップロード**
   - 現在はダミー画像のみ
   - S3 または Cloudinary の実装が必要

9. **位置情報ベースのソート**
   - Google Maps API の実装が必要
   - ユーザー位置情報の取得が必要

10. **プッシュ通知**
    - FCM または OneSignal の実装が必要

---

## 次のステップ

### 即時対応が必要な項目

1. ✅ ドキュメント統合（`PROJECT_SPEC.md` と `DEVELOPMENT_LOG.md` の作成）
2. ⏳ 用語統一（"事業所" → "施設"、"案件" → "求人"）
3. ⏳ 評価システムのデータ構造更新
4. ⏳ ルーティング変更（`/` → 求人一覧、テストインデックス → `/test/index`）
5. ⏳ ブックマーク機能の整理
6. ⏳ CHANGELOG の更新

### Phase 2 以降

- 認証システムの実装
- データベース連携
- API エンドポイントの作成
- リアルタイムメッセージング
- 画像アップロード機能
- 位置情報ベースのソート
- プッシュ通知

---

**最終更新**: 2025-11-24
